<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<title>$pageTool.title</title>
		<link rel="stylesheet" href="/content/dojo/dijit/themes/claro/document.css">
        <link rel="stylesheet" href="/content/dojo/dijit/themes/claro/claro.css">
		<link rel="stylesheet/less" href="/content/style/style.less">
        <script src="/content/less.js"></script>
        <style>
            #appLayout {
            	height: 100%;
        	}
        	html {
        		margin: 0px;
        	}
        	html, body, #mainDiv {
            width: 100%; height: 100%;
            border: 0; padding: 0; margin: 0;
        	}
        	#preloader {
                      width:100%; height:100%; margin:0; padding:0;
                      background:#fff
                        url('$link.content('img/loading.gif')')
                        no-repeat center center;
                        position:absolute;
                        z-index:999;
            }
        </style>
        <script data-dojo-config="async : true , parseOnLoad : false, isDebug:true" src="/content/dojo/dojo/dojo.js"></script>
        <script type="text/javascript" src="/application.js"></script>
        <script type="text/javascript">
                var config = {
                    contextPath: ""
                };
        </script>
	</head>
	<body class="claro">
	        <div id="preloader"></div>
	        <script>
	            require(["dojo/parser", "dojo/dom-style", "dojo/_base/fx", "dojo/on",
	            "dijit/Dialog",
                "dijit/form/Button",
                "dijit/layout/BorderContainer",
                "dijit/layout/TabContainer",
                "dijit/layout/ContentPane",
                "dijit/layout/AccordionContainer",
                "dijit/Calendar",
                "dijit/MenuBar",
                "dijit/MenuBarItem",
                "dijit/form/DateTextBox"],
                function(parser, domStyle, basefx, on){
                        parser.parse().then(function(){
                            basefx.animateProperty({
                                  node: "preloader", duration: 500,
                                  properties: {
                                    opacity: { start: 1, end: 0 },
                                  },
                                  onEnd: function(){
                                    domStyle.set("preloader", "display", "none");
                                  }
                                }).play();
                        });
	            });
	        </script>

    		<div id="appLayout"  data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design: 'headline'">
    			<div data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region : 'top'">
                				  <div id="menubar" data-dojo-type="dijit/MenuBar">
                                      <div id="reservationsMenu" data-dojo-type="dijit/MenuBarItem">Reservations</div>
                                      <div id="housekeepingMenu" data-dojo-type="dijit/MenuBarItem">Housekeeping</div>
                                      <div id="billingMenu" data-dojo-type="dijit/MenuBarItem">Billing</div>
                                      <div id="guestsMenu" data-dojo-type="dijit/MenuBarItem">Guests</div>
                                      <div id="reportsMenu" data-dojo-type="dijit/MenuBarItem">Reports</div>
                                      <div id="inclusionsMenu" data-dojo-type="dijit/MenuBarItem">Inclusions</div>
                                      <div id="nightAuditMenu" data-dojo-type="dijit/MenuBarItem">Night audit</div>
                                  </div>
                                  <div id="submenubar" data-dojo-type="dijit/layout/ContentPane">

                                  </div>

##                				<p>Top panel text</p>
##
##                				<!-- TODO Add toolbar, drop down menu with user specific information, some panel with system information like date and time -->
##
##                				<p>more top panel text ... </p>
##                				<button data-dojo-type="dijit/form/Button" data-dojo-id="CreateTabBtn" type="button">Click to create new tab</button>
##                				<button data-dojo-type="dijit/form/Button" data-dojo-id="ReservationTableBtn" type="button">Reservation Table</button>
##                				<button data-dojo-type="dijit/form/Button" data-dojo-id="LedgeReservationTableBtn" type="button">Ledge Reservation Table</button>
##                                <div data-dojo-type="dijit/layout/ContentPane">
##                                <p>Hello, $username</p>
##                                </div>
                </div>


    			<div data-dojo-type="dijit/layout/TabContainer" data-dojo-id="MainTabContainer" data-dojo-props="region : 'center', splitter : 'false'">

                    $embeddedPlaceholder##
                </div>
    		</div>

    		<script>
    		         require(["dojo/ready", "dojo/on", "dijit/layout/ContentPane", "dojo/request", "dojo/dom-construct",
    		          "dojo/parser", "hotelms/ledge", "dijit/registry", "dojo/_base/array", "dijit/MenuBarItem", "dijit/MenuBar"],
    		         function(ready, on, ContentPane, request, domConstruct, parser, ledge, registry, array, MenuBarItem, MenuBar){
    		            ready(function(){
##    		                    on(CreateTabBtn.domNode, "click", function(event){
##     		                         var cp1 = new ContentPane({
##                                                  title: "New Tab",
##                                                  content: "We offer amazing food"
##                                             });
##                                     MainTabContainer.addChild(cp1);
##    		                    });
##
##
##    		                    on(ReservationTableBtn.domNode, "click", function(event){
##                                    request("$link.view('top.ReservationTable')").then(function(data){
##                                        var dataDOM = domConstruct.toDom(data);
##                                        var cp1 = new ContentPane({
##                                            title: 'Reservation table',
##                                            content: dataDOM
##                                        });
##                                        MainTabContainer.addChild(cp1);
##                                        request("$link.view('top.ReservationTableScript')",{handleAs:'javascript'});
##                                    }, function(err){
##                                       console.log(err);
##                                    }, function(event){
##                                        console.log(event);
##                                    });
##                                });
##                                    ##ledge.tab("$link.view('top.ReservationTable')", { title: 'Reservation Table'});
##                                on(LedgeReservationTableBtn.domNode, "click", function(event){
##                                    ledge.tab("$link.view('top.ReservationTable')", {title: 'Reservation Table fetched by ajax from views and json view'});
##                                });

                                 var menuToSubmenus = {
                                "reservations" : [
                                                  { subMenuItemName : "Open Booking sheet",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  },
                                                  { subMenuItemName : "Book new reservation",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  },
                                                  { subMenuItemName : "Book new reservation",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  },
                                                  { subMenuItemName : "Show check-ins",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  },
                                                  { subMenuItemName : "Show check-outs",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  },
                                                  { subMenuItemName : "Browse reservations",
                                                    viewName : "$link.view('top.ReservationTable')",
                                                    tabTitle : "Booking sheet"
                                                  }
                                                ]
                                };

                                var changeSubmenuTo = function(name)
                                {
                                     var submenubar = registry.byId("submenubar");
                                     submenubar.destroyDescendants(false);
                                     var menuBar = new MenuBar();
                                     submenubar.addChild(menuBar);

                                     array.forEach(menuToSubmenus[name], function(subMenuItem){
                                        var barItem = new MenuBarItem({
                                            title : subMenuItem.subMenuItemName,
                                            label : subMenuItem.subMenuItemName,
                                            onClick : function(){
                                                ledge.tab(subMenuItem.viewName, {title: subMenuItem.tabTitle});
                                            }
                                        });
                                        menuBar.addChild(barItem);
                                     });
                                     registry.byId("appLayout").resize();
                                }

                                on(registry.byId("reservationsMenu"), "click", function(event){
                                   changeSubmenuTo("reservations");
                                });

    		            });
    		         });
    		</script>
    </body>
</html>
$viewEnclosureTool.top()##

